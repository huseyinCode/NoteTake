<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note Take</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Marked Library for Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- KaTeX for LaTeX Math -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

    <!-- Tailwind Config for Custom Colors -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            blue: '#007bff',
                            dark: '#1f2937',
                            darker: '#111827',
                            input: '#374151'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>

<body
    class="bg-brand-dark text-white h-screen overflow-hidden font-sans antialiased selection:bg-brand-blue selection:text-white">

    <!-- =======================
         VIEW 1: LOGIN
         ======================= -->
    <div id="view-login" class="flex w-full h-full">
        <!-- Left Half -->
        <div class="hidden md:flex w-1/2 bg-[#0f172a] flex-col justify-center items-center relative overflow-hidden">
            <!-- Decorative Background Elements -->
            <div class="absolute bottom-0 w-full opacity-10">
                <svg viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg">
                    <path fill="#007bff" fill-opacity="1"
                        d="M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,224C672,245,768,267,864,261.3C960,256,1056,224,1152,197.3C1248,171,1344,149,1392,138.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z">
                    </path>
                </svg>
            </div>

            <div class="z-10 text-center space-y-8">
                <h2 class="text-2xl font-bold tracking-widest text-white uppercase">From Developers<br>To Developers
                </h2>
                <div class="text-6xl font-bold">
                    <span>Note</span>
                    <span class="bg-brand-blue text-white px-4 py-1 rounded-xl ml-2">Take</span>
                </div>
            </div>
        </div>

        <!-- Right Half -->
        <div class="w-full md:w-1/2 bg-gray-100 flex flex-col justify-center items-center p-8 text-gray-800">
            <div class="w-full max-w-md space-y-8">
                <div class="md:hidden text-center mb-8">
                    <span class="text-4xl font-bold text-gray-800">Note <span
                            class="bg-brand-blue text-white px-3 py-1 rounded-lg">Take</span></span>
                </div>

                <div class="bg-white p-8 rounded-2xl shadow-xl space-y-6">
                    <h3 class="text-2xl font-bold text-center text-gray-700">Welcome Back</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-500 ml-1 mb-1">Email</label>
                            <input type="email" id="input-email" placeholder="name@example.com"
                                class="w-full px-6 py-3 bg-gray-100 rounded-full border border-gray-200 focus:outline-none focus:border-brand-blue transition-colors text-gray-800">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-500 ml-1 mb-1">Password</label>
                            <input type="password" id="input-password" placeholder="••••••••"
                                class="w-full px-6 py-3 bg-gray-100 rounded-full border border-gray-200 focus:outline-none focus:border-brand-blue transition-colors text-gray-800">
                        </div>
                    </div>
                    <button id="btn-login"
                        class="w-full bg-brand-blue hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full transition-all transform hover:scale-[1.02] shadow-lg shadow-blue-500/30">
                        Login
                    </button>
                    <div class="text-center mt-4">
                        <span class="text-sm text-gray-500">Don't have an account?</span>
                        <a href="#" onclick="UI.showView('register')"
                            class="text-sm text-brand-blue font-bold hover:underline ml-1">Create Account</a>
                    </div>
                    <p id="login-error" class="text-red-500 text-sm text-center hidden">Login failed. Please try again.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- =======================
         VIEW 1.5: REGISTER
         ======================= -->
    <div id="view-register" class="hidden flex w-full h-full">
        <!-- Left Half (Same as Login) -->
        <div class="hidden md:flex w-1/2 bg-[#0f172a] flex-col justify-center items-center relative overflow-hidden">
            <div class="absolute bottom-0 w-full opacity-10">
                <svg viewBox="0 0 1440 320" xmlns="http://www.w3.org/2000/svg">
                    <path fill="#007bff" fill-opacity="1"
                        d="M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,224C672,245,768,267,864,261.3C960,256,1056,224,1152,197.3C1248,171,1344,149,1392,138.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z">
                    </path>
                </svg>
            </div>
            <div class="z-10 text-center space-y-8">
                <h2 class="text-2xl font-bold tracking-widest text-white uppercase">Join the<br>Community</h2>
                <div class="text-6xl font-bold">
                    <span>Note</span>
                    <span class="bg-brand-blue text-white px-4 py-1 rounded-xl ml-2">Take</span>
                </div>
            </div>
        </div>

        <!-- Right Half -->
        <div class="w-full md:w-1/2 bg-gray-100 flex flex-col justify-center items-center p-8 text-gray-800">
            <div class="w-full max-w-md space-y-8">
                <div class="md:hidden text-center mb-8">
                    <span class="text-4xl font-bold text-gray-800">Note <span
                            class="bg-brand-blue text-white px-3 py-1 rounded-lg">Take</span></span>
                </div>

                <div class="bg-white p-8 rounded-2xl shadow-xl space-y-6">
                    <h3 class="text-2xl font-bold text-center text-gray-700">Create Account</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-500 ml-1 mb-1">Email</label>
                            <input type="email" id="reg-email" placeholder="name@example.com"
                                class="w-full px-6 py-3 bg-gray-100 rounded-full border border-gray-200 focus:outline-none focus:border-brand-blue transition-colors text-gray-800">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-500 ml-1 mb-1">Password</label>
                            <input type="password" id="reg-password" placeholder="••••••••"
                                class="w-full px-6 py-3 bg-gray-100 rounded-full border border-gray-200 focus:outline-none focus:border-brand-blue transition-colors text-gray-800">
                        </div>
                    </div>
                    <button id="btn-register"
                        class="w-full bg-brand-blue hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full transition-all transform hover:scale-[1.02] shadow-lg shadow-blue-500/30">
                        Register
                    </button>
                    <div class="text-center mt-4">
                        <span class="text-sm text-gray-500">Already have an account?</span>
                        <a href="#" onclick="UI.showView('login')"
                            class="text-sm text-brand-blue font-bold hover:underline ml-1">Login</a>
                    </div>
                    <p id="reg-error" class="text-red-500 text-sm text-center hidden">Registration failed.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- =======================
         VIEW 2: DASHBOARD
         ======================= -->
    <div id="view-dashboard" class="hidden h-full flex flex-col fade-in relative">
        <!-- Header -->
        <header
            class="h-20 border-b border-gray-800 flex items-center justify-between px-8 bg-[#0f172a]/80 backdrop-blur-md sticky top-0 z-50 transition-all">
            <!-- Logo -->
            <div class="text-2xl font-bold select-none cursor-pointer flex items-center gap-2"
                onclick="app.showDashboard()">

                <span class="tracking-tight">Note<span class="text-brand-blue">Take</span></span>
            </div>

            <!-- Search Bar -->
            <div class="flex-1 max-w-xl mx-12 hidden md:block group">
                <div class="relative transition-all transform group-focus-within:scale-[1.02]">
                    <svg class="absolute left-4 top-3.5 h-5 w-5 text-gray-500 group-focus-within:text-brand-blue transition-colors"
                        fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text" id="search-input" placeholder="Search your notes..."
                        class="w-full bg-[#1e293b] text-sm text-white placeholder-gray-500 pl-12 pr-4 py-3 rounded-2xl border border-gray-700/50 focus:border-brand-blue/50 focus:bg-[#1e293b]/80 focus:ring-4 focus:ring-brand-blue/10 outline-none transition-all shadow-lg shadow-black/20">
                    <div class="absolute right-3 top-2.5 hidden group-focus-within:flex gap-1">
                        <kbd
                            class="hidden sm:inline-block px-2 py-0.5 bg-gray-700 text-gray-400 rounded-md text-[10px] font-mono border border-gray-600">CMD+K</kbd>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="flex items-center gap-6">
                <div class="flex items-center gap-3">
                    <div class="text-right hidden sm:block">
                        <div id="user-email-display" class="text-xs font-medium text-gray-300"></div>
                        <button id="btn-logout"
                            class="text-[10px] uppercase tracking-wider text-gray-500 hover:text-white transition-colors font-bold text-right ml-auto block">
                            Logout
                        </button>
                    </div>

                </div>

                <button onclick="app.createNewNote()"
                    class="bg-brand-blue hover:bg-blue-600 active:scale-95 text-white pl-4 pr-5 py-2.5 rounded-xl text-sm font-bold transition-all shadow-lg shadow-blue-500/25 border border-white/10 flex items-center gap-2 group">
                    <svg class="w-5 h-5 group-hover:rotate-90 transition-transform" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    <span>New Note</span>
                </button>
            </div>
        </header>

        <!-- Grid Content -->
        <main class="flex-1 overflow-y-auto p-8 bg-brand-dark">
            <div id="notes-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Notes will be injected here -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="hidden flex flex-col items-center justify-center h-64 text-gray-500 mt-12">
                <svg class="w-16 h-16 mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                    </path>
                </svg>
                <p class="text-xl">No notes yet.</p>
                <p class="text-sm mt-2">Create one to get started!</p>
            </div>
        </main>
    </div>

    <!-- =======================
         VIEW 3: EDITOR
         ======================= -->
    <div id="view-editor" class="hidden h-full flex fade-in">
        <!-- Sidebar -->
        <aside class="w-64 bg-[#111827] border-r border-gray-800 flex flex-col hidden md:flex">
            <div class="p-4 border-b border-gray-800 flex items-center justify-between">
                <div class="text-xl font-bold select-none cursor-pointer flex items-center gap-2"
                    onclick="app.showDashboard()">
                    <span class="tracking-tight text-white">Note<span class="text-brand-blue">Take</span></span>
                </div>
                <button onclick="app.openAIModal()"
                    class="flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-gradient-to-r from-indigo-500/10 to-purple-500/10 border border-indigo-500/20 hover:border-indigo-500/50 hover:from-indigo-500/20 hover:to-purple-500/20 text-indigo-400 hover:text-indigo-300 transition-all text-xs font-medium group">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    <span>AI</span>
                </button>
            </div>
            <div class="p-4">
                <button onclick="app.createNewNote()"
                    class="w-full bg-brand-blue hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg mb-4 transition-colors shadow-lg shadow-blue-900/20">
                    Create New Note
                </button>
                <div class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">My Notes</div>
                <div id="sidebar-notes-list" class="space-y-2 overflow-y-auto h-[calc(100vh-180px)] pr-2">
                    <!-- Note items injected here -->
                </div>
            </div>
        </aside>

        <!-- Main Editor Area -->
        <main class="flex-1 flex flex-col bg-brand-dark h-full relative">

            <!-- Mobile Back Button Header -->
            <div class="md:hidden h-12 border-b border-gray-700 flex items-center px-4 bg-[#111827]">
                <button onclick="app.showDashboard()" class="text-gray-400 hover:text-white mr-4">← Back</button>
                <span class="text-sm text-gray-500 ml-auto">Ctrl+E to toggle View</span>
            </div>

            <!-- Editor Header -->
            <div class="h-auto p-8 pb-4">
                <div class="flex justify-between items-center mb-2">
                    <span id="last-edited" class="text-xs text-gray-500 font-mono">Last edited: Just now</span>
                    <div class="flex items-center gap-4">
                        <span id="save-status"
                            class="text-xs text-brand-blue font-medium opacity-0 transition-opacity">Saved</span>
                        <button onclick="app.requestDelete(event, currentNoteId)"
                            class="text-gray-500 hover:text-red-500 transition-colors" title="Delete Note">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                </div>
                <input type="text" id="note-title" placeholder="Untitled Note"
                    class="w-full bg-transparent text-4xl font-bold text-white placeholder-gray-600 border-none focus:outline-none focus:ring-0 px-0">
            </div>

            <!-- Content Area (Relative for toggling) -->
            <div class="flex-1 relative overflow-hidden px-8 pb-8">

                <!-- 1. Text Area (Edit Mode) -->
                <textarea id="note-content" placeholder="Start writing in Markdown..."
                    class="w-full h-full bg-transparent text-gray-300 resize-none border-none focus:outline-none focus:ring-0 font-mono text-lg leading-relaxed custom-scrollbar"></textarea>

                <!-- 2. Preview Div (Read Mode) -->
                <div id="note-preview" class="hidden w-full h-full overflow-y-auto markdown-preview pb-20">
                    <!-- Markdown rendered here -->
                </div>

                <!-- Floating Toggle Indicator -->
                <div
                    class="absolute bottom-6 right-8 bg-[#111827] border border-gray-700 rounded-full px-4 py-2 text-xs text-gray-400 shadow-lg pointer-events-none opacity-80 z-20">
                    <span id="mode-indicator">EDIT MODE</span> <span class="opacity-50">| Ctrl+E</span>
                </div>

                <!-- Markdown Help Badge -->
                <div class="absolute bottom-6 left-8 bg-[#111827] border border-gray-700 rounded-full px-3 py-1 text-xs text-gray-500 opacity-50 hover:opacity-100 transition-opacity cursor-help"
                    title="Supports Markdown: **bold**, *italic*, # Header, - List">
                    Markdown Supported
                </div>
            </div>
        </main>
    </div>

    <!-- =======================
         MODAL: DELETE CONFIRMATION
         ======================= -->
    <div id="modal-delete"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in backdrop-blur-sm">
        <div class="bg-[#1f2937] p-6 rounded-2xl shadow-2xl max-w-sm w-full mx-4 border border-gray-700">
            <h3 class="text-xl font-bold text-white mb-2">Delete Note?</h3>
            <p class="text-gray-400 mb-6">Are you sure you want to delete this note? This action cannot be undone.</p>
            <div class="flex justify-end space-x-3">
                <button onclick="app.closeModal()"
                    class="px-4 py-2 rounded-lg text-gray-300 hover:bg-gray-700 transition-colors">Cancel</button>
                <button onclick="app.confirmDelete()"
                    class="px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white font-medium transition-colors">Delete</button>
            </div>
        </div>
    </div>

    <!-- =======================
         MODAL: GEMINI AI
         ======================= -->
    <div id="modal-ai"
        class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 fade-in backdrop-blur-sm">
        <div
            class="bg-[#1f2937] p-6 rounded-2xl shadow-2xl max-w-2xl w-full mx-4 border border-gray-700 flex flex-col max-h-[90vh]">

            <!-- Header -->
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-2">
                    <svg class="w-6 h-6 text-brand-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    <h3 class="text-xl font-bold text-white">Gemini AI Assistant</h3>
                </div>
                <button onclick="app.closeAIModal()" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <!-- API Key Input (Only shown if needed, handled by JS) -->
            <div id="ai-key-section" class="mb-4 hidden">
                <label class="block text-xs text-gray-400 mb-1">Enter Gemini API Key</label>
                <input type="password" id="ai-api-key" placeholder="Paste your API Key here"
                    class="w-full px-4 py-2 bg-[#111827] rounded-lg border border-gray-600 text-white focus:border-brand-blue outline-none text-sm">
            </div>

            <!-- Mode Selection / Prompt -->
            <div class="space-y-4 flex-1 overflow-auto custom-scrollbar">

                <!-- Prompt Input -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">What would you like to do?</label>
                    <div class="flex gap-2 mb-2">
                        <button onclick="app.setAIPrompt('Summarize this note')"
                            class="px-3 py-1.5 rounded-lg bg-[#374151] hover:bg-[#4b5563] text-xs text-white transition-colors">Summarize
                            Note</button>
                        <button onclick="app.setAIPrompt('Fix grammar and improve writing')"
                            class="px-3 py-1.5 rounded-lg bg-[#374151] hover:bg-[#4b5563] text-xs text-white transition-colors">Fix
                            Grammar</button>
                        <button onclick="app.setAIPrompt('Generate a to-do list based on this')"
                            class="px-3 py-1.5 rounded-lg bg-[#374151] hover:bg-[#4b5563] text-xs text-white transition-colors">Create
                            To-Do</button>
                    </div>
                    <textarea id="ai-prompt"
                        placeholder="Enter your prompt here (e.g., 'Summarize this note', 'Write a poem about code')..."
                        class="w-full h-24 bg-[#111827] text-gray-200 p-4 rounded-xl border border-gray-600 focus:border-brand-blue outline-none resize-none"></textarea>
                </div>

                <!-- Response Area -->
                <div id="ai-response-container" class="hidden">
                    <label class="block text-sm font-medium text-gray-300 mb-2 h-0">Result:</label>
                    <div id="ai-result"
                        class="bg-[#111827] p-4 rounded-xl border border-gray-600 text-gray-300 text-sm overflow-y-auto max-h-60 font-mono whitespace-pre-wrap">
                    </div>
                </div>

                <!-- Loading State -->
                <div id="ai-loading" class="hidden flex items-center justify-center p-8">
                    <svg class="animate-spin h-8 w-8 text-brand-blue" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    <span class="ml-3 text-gray-400">Thinking...</span>
                </div>
            </div>

            <!-- Footer Actions -->
            <div class="mt-6 pt-4 border-t border-gray-700 flex justify-end gap-3">
                <button onclick="app.runAI()" id="btn-ai-generate"
                    class="px-6 py-2 rounded-lg bg-brand-blue hover:bg-blue-600 text-white font-bold shadow-lg shadow-blue-500/20 transition-all">
                    Generate
                </button>
                <div id="ai-result-actions" class="hidden flex gap-3">
                    <button onclick="app.closeAIModal()"
                        class="px-4 py-2 rounded-lg text-gray-300 hover:bg-gray-700 transition-colors">Discard</button>
                    <button onclick="app.applyAIResult('append')"
                        class="px-4 py-2 rounded-lg bg-[#374151] hover:bg-[#4b5563] text-white font-medium transition-colors">Append</button>
                    <button onclick="app.applyAIResult('replace')"
                        class="px-4 py-2 rounded-lg bg-brand-blue hover:bg-blue-600 text-white font-medium transition-colors">Replace
                        Note</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App Logic -->
    <script src="js/config.js"></script>
    <script type="module" src="js/app.js"></script>
</body>

</html>